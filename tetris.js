(()=>{var e={574:e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function n(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function r(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||e,o),h=i?i+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],a]:e._events[h].push(a):(e._events[h]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,r,o){var a=i?i+e:e;if(!this._events[a])return!1;var h,c,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,s),!0;case 5:return l.fn.call(l.context,t,n,s,r),!0;case 6:return l.fn.call(l.context,t,n,s,r,o),!0}for(c=1,h=new Array(p-1);c<p;c++)h[c-1]=arguments[c];l.fn.apply(l.context,h)}else{var u,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),p){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,s);break;default:if(!h)for(u=1,h=new Array(p-1);u<p;u++)h[u-1]=arguments[u];l[c].fn.apply(l[c].context,h)}}return!0},a.prototype.on=function(e,t,i){return r(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return r(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,n,s){var r=i?i+e:e;if(!this._events[r])return this;if(!t)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||o(this,r);else{for(var h=0,c=[],l=a.length;h<l;h++)(a[h].fn!==t||s&&!a[h].once||n&&a[h].context!==n)&&c.push(a[h]);c.length?this._events[r]=1===c.length?c[0]:c:o(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a},947:(e,t,i)=>{var n;!function(s,r,o){if(s){for(var a,h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},l={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},p={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u=1;u<20;++u)h[111+u]="f"+u;for(u=0;u<=9;++u)h[u+96]=u.toString();b.prototype.bind=function(e,t,i){var n=this;return e=e instanceof Array?e:[e],n._bindMultiple.call(n,e,t,i),n},b.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},b.prototype.trigger=function(e,t){var i=this;return i._directMap[e+":"+t]&&i._directMap[e+":"+t]({},e),i},b.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},b.prototype.stopCallback=function(e,t){if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(g(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var i=e.composedPath()[0];i!==e.target&&(t=i)}return"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},b.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},b.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t]);a=null},b.init=function(){var e=b(r);for(var t in e)"_"!==t.charAt(0)&&(b[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},b.init(),s.Mousetrap=b,e.exports&&(e.exports=b),void 0===(n=function(){return b}.call(t,i,t,e))||(e.exports=n)}function f(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function d(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return h[e.which]?h[e.which]:c[e.which]?c[e.which]:String.fromCharCode(e.which).toLowerCase()}function v(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function y(e,t,i){return i||(i=function(){if(!a)for(var e in a={},h)e>95&&e<112||h.hasOwnProperty(e)&&(a[h[e]]=e);return a}()[e]?"keydown":"keypress"),"keypress"==i&&t.length&&(i="keydown"),i}function m(e,t){var i,n,s,r=[];for(i=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),s=0;s<i.length;++s)n=i[s],p[n]&&(n=p[n]),t&&"keypress"!=t&&l[n]&&(n=l[n],r.push("shift")),v(n)&&r.push(n);return{key:n,modifiers:r,action:t=y(n,r,t)}}function g(e,t){return null!==e&&e!==r&&(e===t||g(e.parentNode,t))}function b(e){var t=this;if(e=e||r,!(t instanceof b))return new b(e);t.target=e,t._callbacks={},t._directMap={};var i,n={},s=!1,o=!1,a=!1;function h(e){e=e||{};var t,i=!1;for(t in n)e[t]?i=!0:n[t]=0;i||(a=!1)}function c(e,i,s,r,o,a){var h,c,l,p,u=[],f=s.type;if(!t._callbacks[e])return[];for("keyup"==f&&v(e)&&(i=[e]),h=0;h<t._callbacks[e].length;++h)if(c=t._callbacks[e][h],(r||!c.seq||n[c.seq]==c.level)&&f==c.action&&("keypress"==f&&!s.metaKey&&!s.ctrlKey||(l=i,p=c.modifiers,l.sort().join(",")===p.sort().join(",")))){var d=!r&&c.combo==o,y=r&&c.seq==r&&c.level==a;(d||y)&&t._callbacks[e].splice(h,1),u.push(c)}return u}function l(e,i,n,s){t.stopCallback(i,i.target||i.srcElement,n,s)||!1===e(i,n)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(i),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(i))}function p(e){"number"!=typeof e.which&&(e.which=e.keyCode);var i=d(e);i&&("keyup"!=e.type||s!==i?t.handleKey(i,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):s=!1)}function u(e,r,o,p,f){t._directMap[e+":"+o]=r;var v,y=(e=e.replace(/\s+/g," ")).split(" ");y.length>1?function(e,t,r,o){function c(t){return function(){a=t,++n[e],clearTimeout(i),i=setTimeout(h,1e3)}}function p(t){l(r,t,e),"keyup"!==o&&(s=d(t)),setTimeout(h,10)}n[e]=0;for(var f=0;f<t.length;++f){var v=f+1===t.length?p:c(o||m(t[f+1]).action);u(t[f],v,o,e,f)}}(e,y,r,o):(v=m(e,o),t._callbacks[v.key]=t._callbacks[v.key]||[],c(v.key,v.modifiers,{type:v.action},p,e,f),t._callbacks[v.key][p?"unshift":"push"]({callback:r,modifiers:v.modifiers,action:v.action,seq:p,level:f,combo:e}))}t._handleKey=function(e,t,i){var n,s=c(e,t,i),r={},p=0,u=!1;for(n=0;n<s.length;++n)s[n].seq&&(p=Math.max(p,s[n].level));for(n=0;n<s.length;++n)if(s[n].seq){if(s[n].level!=p)continue;u=!0,r[s[n].seq]=1,l(s[n].callback,i,s[n].combo,s[n].seq)}else u||l(s[n].callback,i,s[n].combo);var f="keypress"==i.type&&o;i.type!=a||v(e)||f||h(r),o=u&&"keydown"==i.type},t._bindMultiple=function(e,t,i){for(var n=0;n<e.length;++n)u(e[n],t,i)},f(e,"keypress",p),f(e,"keydown",p),f(e,"keyup",p)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)}},t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=i(947),t=i.n(e),n=i(574),s=i.n(n);class r{constructor(e){let t,i;for(this.events=new(s()),this.grid=[],this.height=e.height,this.width=e.width,this.size=e.size,t=0;t<this.height;t++)for(this.grid[t]=[],i=0;i<this.width;i++)this.grid[t].push({color:null,hit:!1});this.prevPositions=[]}_checkLines(){let e,t,i,n,s=0;for(e=0;e<this.height;e++){let r=!0;for(t=0;t<this.width;t++)this.grid[e][t].hit||(r=!1);if(r){for(s++,i=e+1;i--;)this.grid[i]=this.grid[i-1];for(this.grid[0]=[],n=0;n<this.width;n++)this.grid[0].push({color:null,hit:!1})}}s&&this.events.emit("score",s)}collision(e){let t=!1;return e.map((e=>{e.y<0||(e.y>=this.height||e.x<0||e.x>=this.width?t=!0:void 0!==this.grid[e.y]?this.grid[e.y][e.x].hit&&(t=!0):t=!0)})),t}render(e){let t,i;for(e.strokeStyle="#111",t=0;t<this.grid.length;t++)for(i=0;i<this.grid[t].length;i++)e.beginPath(),e.rect(this.size*i,this.size*t,this.size,this.size),this.grid[t][i].color?(e.fillStyle=this.grid[t][i].color,e.fill()):e.stroke()}setPiece(e){this.prevPositions.map((e=>{e.y<0?this.events.emit("end"):this.grid[e.y][e.x].hit=!0})),this._checkLines(),this.prevPositions=[],this.piece=e}setPosition(e){this.prevPositions.map((e=>{e.y<0||(this.grid[e.y][e.x].color=null)})),this.prevPositions=e,e.map((e=>{e.y<0||(this.grid[e.y][e.x].color=this.piece.color)}))}}const o=[{symbol:"I",color:"cyan",shape:[[1,1,1,1]]},{symbol:"J",color:"blue",shape:[[1,1,1],[0,0,1]]},{symbol:"L",color:"orange",shape:[[1,1,1],[1,0,0]]},{symbol:"O",color:"yellow",shape:[[1,1],[1,1]]},{symbol:"S",color:"lime",shape:[[0,1,1],[1,1,0]]},{symbol:"T",color:"purple",shape:[[1,1,1],[0,1,0]]},{symbol:"Z",color:"red",shape:[[1,1,0],[0,1,1]]}];class a{constructor(e){this.events=new(s()),this.size=e.size,this.width=e.width,this.storage={}}_store(e,t,i){return{positions:this.getPosition(),shape:e,x:t,y:i}}_test(e){this.events.emit("test",this._store(this.piece.shape,this.x,this.y),e)}accept(){this.storage=this._store(this.piece.shape,this.x,this.y),this.events.emit("positions",this.storage.positions)}deny(){this.piece.shape=this.storage.shape,this.x=this.storage.x,this.y=this.storage.y}getPosition(){let e,t,i=[],n=this.x,s=this.y;for(e=0;e<this.piece.shape.length;e++){for(t=0;t<this.piece.shape[e].length;t++)this.piece.shape[e][t]&&i.push({x:n,y:s}),n++;n=this.x,s++}return i}init(){switch(this.x=this.width/2,this.y=-3,this.piece=o[Math.floor(Math.random()*o.length)],this.events.emit("piece",this.piece),this.piece.symbol){case"I":this.x-=2,this.y++;break;case"J":case"L":this.x-=2;break;case"O":this.x-=1;break;case"S":case"T":this.x-=2;break;case"Z":default:this.x-=2}this.accept()}move(e){let t="";switch(e){case"LEFT":this.x--;break;case"RIGHT":this.x++;break;case"DOWN":default:t="update",this.y++}this._test(t)}rotate(){let e,t,i=[];for(e=this.piece.shape.length-1;e>=0;e--)for(t=0;t<this.piece.shape[e].length;t++)void 0===i[t]&&(i[t]=[]),i[t].push(this.piece.shape[e][t]);this.piece.shape=i,this._test()}update(){this.y++,this._test("update")}}const h={height:20,size:30,width:10,sidebar:100},c=document.getElementById("tetris");c.width=h.width*h.size+h.sidebar,c.height=h.height*h.size,c.style.display="block",c.style.margin="0 auto";const l=c.getContext("2d");let p,u,f,d,v,y=[];const m=()=>{u=window.requestAnimationFrame(m),l.beginPath(),l.rect(0,0,c.width-h.sidebar,c.height),l.fillStyle="#000",l.fill(),l.beginPath(),l.rect(c.width-h.sidebar,0,h.sidebar,c.height),l.fillStyle="#222",l.fill(),l.beginPath(),l.font="16px sans-serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="#ddd",l.fillText("points",c.width-h.sidebar+h.sidebar/2,25),l.fillText(d,c.width-h.sidebar+h.sidebar/2,50),f.render(l)},g=e=>{f.setPiece(e)},b=e=>{f.setPosition(e)},w=(e,t)=>{f.collision(e.positions)?(y[0].deny(),"update"===t&&(y[0].events.removeListener("piece",g),y[0].events.removeListener("positions",b),y[0].events.removeListener("test",g),y.unshift(new a(h)),y[0].events.on("piece",g),y[0].events.on("positions",b),y[0].events.on("test",w),y[0].init())):y[0].accept()},_=e=>{d+=e*e},x=()=>{u&&(window.cancelAnimationFrame(u),u=null),l.beginPath(),l.rect(0,c.height/2-30,c.width-h.sidebar,60),l.fillStyle="rgba(255,255,255,0.5)",l.fill(),l.beginPath(),l.font="48px sans-serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="#f00",l.fillText("Game over",(c.width-h.sidebar)/2,c.height/2)},k=()=>{v&&(clearTimeout(v),v=null),y[0].update(),v=setTimeout(k,p)},P=()=>{u&&(window.cancelAnimationFrame(u),u=null),v&&(clearTimeout(v),v=null),p=500,d=0,f&&(f.events.removeListener("score",_),f.events.removeListener("end",x)),f=new r(h),f.events.on("score",_),f.events.on("end",x),y[0]&&(y[0].events.removeListener("piece",g),y[0].events.removeListener("positions",b),y[0].events.removeListener("test",g),y=[]),y.unshift(new a(h)),y[0].events.on("piece",g),y[0].events.on("positions",b),y[0].events.on("test",w),y[0].init(),u=window.requestAnimationFrame(m),k()};P(),function({move:e,newGame:i,rotate:n}){t().bind("up",(()=>{n()})),t().bind("right",(()=>{e("RIGHT")})),t().bind("down",(()=>{e("DOWN")})),t().bind("left",(()=>{e("LEFT")})),t().bind("enter",(()=>{i()})),t().bind("space",(()=>{i()}))}({move:e=>{v&&(clearTimeout(v),v=null),v=setTimeout(k,p),y[0].move(e)},newGame:P,rotate:()=>{v&&(clearTimeout(v),v=null),v=setTimeout(k,p),y[0].rotate()}})})()})();
//# sourceMappingURL=tetris.js.map