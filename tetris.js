!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){var n;!function(s,r,o){if(s){for(var a,c={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},l={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},p=1;p<20;++p)c[111+p]="f"+p;for(p=0;p<=9;++p)c[p+96]=p.toString();g.prototype.bind=function(e,t,i){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,i),this},g.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},g.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},g.prototype.reset=function(){return this._callbacks={},this._directMap={},this},g.prototype.stopCallback=function(e,t){if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(function e(t,i){return null!==t&&t!==r&&(t===i||e(t.parentNode,i))}(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var i=e.composedPath()[0];i!==e.target&&(t=i)}return"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},g.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},g.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(c[t]=e[t]);a=null},g.init=function(){var e=g(r);for(var t in e)"_"!==t.charAt(0)&&(g[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},g.init(),s.Mousetrap=g,e.exports&&(e.exports=g),void 0===(n=function(){return g}.call(t,i,t,e))||(e.exports=n)}function f(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function d(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return c[e.which]?c[e.which]:h[e.which]?h[e.which]:String.fromCharCode(e.which).toLowerCase()}function y(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function v(e,t,i){return i||(i=function(){if(!a)for(var e in a={},c)e>95&&e<112||c.hasOwnProperty(e)&&(a[c[e]]=e);return a}()[e]?"keydown":"keypress"),"keypress"==i&&t.length&&(i="keydown"),i}function m(e,t){var i,n,s,r=[];for(i=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),s=0;s<i.length;++s)n=i[s],u[n]&&(n=u[n]),t&&"keypress"!=t&&l[n]&&(n=l[n],r.push("shift")),y(n)&&r.push(n);return{key:n,modifiers:r,action:t=v(n,r,t)}}function g(e){var t=this;if(e=e||r,!(t instanceof g))return new g(e);t.target=e,t._callbacks={},t._directMap={};var i,n={},s=!1,o=!1,a=!1;function c(e){e=e||{};var t,i=!1;for(t in n)e[t]?i=!0:n[t]=0;i||(a=!1)}function h(e,i,s,r,o,a){var c,h,l,u,p=[],f=s.type;if(!t._callbacks[e])return[];for("keyup"==f&&y(e)&&(i=[e]),c=0;c<t._callbacks[e].length;++c)if(h=t._callbacks[e][c],(r||!h.seq||n[h.seq]==h.level)&&f==h.action&&("keypress"==f&&!s.metaKey&&!s.ctrlKey||(l=i,u=h.modifiers,l.sort().join(",")===u.sort().join(",")))){var d=!r&&h.combo==o,v=r&&h.seq==r&&h.level==a;(d||v)&&t._callbacks[e].splice(c,1),p.push(h)}return p}function l(e,i,n,s){t.stopCallback(i,i.target||i.srcElement,n,s)||!1===e(i,n)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(i),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(i))}function u(e){"number"!=typeof e.which&&(e.which=e.keyCode);var i=d(e);i&&("keyup"!=e.type||s!==i?t.handleKey(i,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):s=!1)}function p(e,t,r,o){function h(t){return function(){a=t,++n[e],clearTimeout(i),i=setTimeout(c,1e3)}}function u(t){l(r,t,e),"keyup"!==o&&(s=d(t)),setTimeout(c,10)}n[e]=0;for(var p=0;p<t.length;++p){var f=p+1===t.length?u:h(o||m(t[p+1]).action);v(t[p],f,o,e,p)}}function v(e,i,n,s,r){t._directMap[e+":"+n]=i;var o,a=(e=e.replace(/\s+/g," ")).split(" ");a.length>1?p(e,a,i,n):(o=m(e,n),t._callbacks[o.key]=t._callbacks[o.key]||[],h(o.key,o.modifiers,{type:o.action},s,e,r),t._callbacks[o.key][s?"unshift":"push"]({callback:i,modifiers:o.modifiers,action:o.action,seq:s,level:r,combo:e}))}t._handleKey=function(e,t,i){var n,s=h(e,t,i),r={},u=0,p=!1;for(n=0;n<s.length;++n)s[n].seq&&(u=Math.max(u,s[n].level));for(n=0;n<s.length;++n)if(s[n].seq){if(s[n].level!=u)continue;p=!0,r[s[n].seq]=1,l(s[n].callback,i,s[n].combo,s[n].seq)}else p||l(s[n].callback,i,s[n].combo);var f="keypress"==i.type&&o;i.type!=a||y(e)||f||c(r),o=p&&"keydown"==i.type},t._bindMultiple=function(e,t,i){for(var n=0;n<e.length;++n)v(e[n],t,i)},f(e,"keypress",u),f(e,"keydown",u),f(e,"keyup",u)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,s="~";function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,r),c=s?s+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function h(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),h.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},h.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},h.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},h.prototype.emit=function(e,t,i,n,r,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,h,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,n),!0;case 5:return l.fn.call(l.context,t,i,n,r),!0;case 6:return l.fn.call(l.context,t,i,n,r,o),!0}for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];l.fn.apply(l.context,c)}else{var p,f=l.length;for(h=0;h<f;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,i);break;case 4:l[h].fn.call(l[h].context,t,i,n);break;default:if(!c)for(p=1,c=new Array(u-1);p<u;p++)c[p-1]=arguments[p];l[h].fn.apply(l[h].context,c)}}return!0},h.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},h.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},h.prototype.removeListener=function(e,t,i,n){var r=s?s+e:e;if(!this._events[r])return this;if(!t)return c(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||c(this,r);else{for(var a=0,h=[],l=o.length;a<l;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&h.push(o[a]);h.length?this._events[r]=1===h.length?h[0]:h:c(this,r)}return this},h.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&c(this,t)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=s,h.EventEmitter=h,e.exports=h},function(e,t,i){"use strict";i.r(t);var n=i(0),s=i.n(n);var r=i(1),o=i.n(r);class a{constructor(e){let t,i;for(this.events=new o.a,this.grid=[],this.height=e.height,this.width=e.width,this.size=e.size,t=0;t<this.height;t++)for(this.grid[t]=[],i=0;i<this.width;i++)this.grid[t].push({color:null,hit:!1});this.prevPositions=[]}_checkLines(){let e,t,i,n,s=0;for(e=0;e<this.height;e++){let r=!0;for(t=0;t<this.width;t++)this.grid[e][t].hit||(r=!1);if(r){for(s++,i=e+1;i--;)this.grid[i]=this.grid[i-1];for(this.grid[0]=[],n=0;n<this.width;n++)this.grid[0].push({color:null,hit:!1})}}s&&this.events.emit("score",s)}collision(e){let t=!1;return e.map(e=>{e.y<0||(e.y>=this.height||e.x<0||e.x>=this.width?t=!0:void 0!==this.grid[e.y]?this.grid[e.y][e.x].hit&&(t=!0):t=!0)}),t}render(e){let t,i;for(e.strokeStyle="#111",t=0;t<this.grid.length;t++)for(i=0;i<this.grid[t].length;i++)e.beginPath(),e.rect(this.size*i,this.size*t,this.size,this.size),this.grid[t][i].color?(e.fillStyle=this.grid[t][i].color,e.fill()):e.stroke()}setPiece(e){this.prevPositions.map(e=>{e.y<0?this.events.emit("end"):this.grid[e.y][e.x].hit=!0}),this._checkLines(),this.prevPositions=[],this.piece=e}setPosition(e){this.prevPositions.map(e=>{e.y<0||(this.grid[e.y][e.x].color=null)}),this.prevPositions=e,e.map(e=>{e.y<0||(this.grid[e.y][e.x].color=this.piece.color)})}}const c=[{symbol:"I",color:"cyan",shape:[[1,1,1,1]]},{symbol:"J",color:"blue",shape:[[1,1,1],[0,0,1]]},{symbol:"L",color:"orange",shape:[[1,1,1],[1,0,0]]},{symbol:"O",color:"yellow",shape:[[1,1],[1,1]]},{symbol:"S",color:"lime",shape:[[0,1,1],[1,1,0]]},{symbol:"T",color:"purple",shape:[[1,1,1],[0,1,0]]},{symbol:"Z",color:"red",shape:[[1,1,0],[0,1,1]]}];class h{constructor(e){this.events=new o.a,this.size=e.size,this.width=e.width,this.storage={}}_store(e,t,i){return{positions:this.getPosition(),shape:e,x:t,y:i}}_test(e){this.events.emit("test",this._store(this.piece.shape,this.x,this.y),e)}accept(){this.storage=this._store(this.piece.shape,this.x,this.y),this.events.emit("positions",this.storage.positions)}deny(){this.piece.shape=this.storage.shape,this.x=this.storage.x,this.y=this.storage.y}getPosition(){let e,t,i=[],n=this.x,s=this.y;for(e=0;e<this.piece.shape.length;e++){for(t=0;t<this.piece.shape[e].length;t++)this.piece.shape[e][t]&&i.push({x:n,y:s}),n++;n=this.x,s++}return i}init(){switch(this.x=this.width/2,this.y=-3,this.piece=c[Math.floor(Math.random()*c.length)],this.events.emit("piece",this.piece),this.piece.symbol){case"I":this.x-=2,this.y++;break;case"J":case"L":this.x-=2;break;case"O":this.x-=1;break;case"S":case"T":this.x-=2;break;case"Z":default:this.x-=2}this.accept()}move(e){let t="";switch(e){case"LEFT":this.x--;break;case"RIGHT":this.x++;break;case"DOWN":default:t="update",this.y++}this._test(t)}rotate(){let e,t,i=[];for(e=this.piece.shape.length-1;e>=0;e--)for(t=0;t<this.piece.shape[e].length;t++)void 0===i[t]&&(i[t]=[]),i[t].push(this.piece.shape[e][t]);this.piece.shape=i,this._test()}update(){this.y++,this._test("update")}}const l={height:20,size:30,width:10,sidebar:100},u=document.getElementById("tetris");u.width=l.width*l.size+l.sidebar,u.height=l.height*l.size,u.style.display="block",u.style.margin="0 auto";const p=u.getContext("2d");let f,d,y,v,m,g=[];const b=()=>{d=window.requestAnimationFrame(b),p.beginPath(),p.rect(0,0,u.width-l.sidebar,u.height),p.fillStyle="#000",p.fill(),p.beginPath(),p.rect(u.width-l.sidebar,0,l.sidebar,u.height),p.fillStyle="#222",p.fill(),p.beginPath(),p.font="16px sans-serif",p.textAlign="center",p.textBaseline="middle",p.fillStyle="#ddd",p.fillText("points",u.width-l.sidebar+l.sidebar/2,25),p.fillText(v,u.width-l.sidebar+l.sidebar/2,50),y.render(p)},w=e=>{y.setPiece(e)},_=e=>{y.setPosition(e)},x=(e,t)=>{y.collision(e.positions)?(g[0].deny(),"update"===t&&(g[0].events.removeListener("piece",w),g[0].events.removeListener("positions",_),g[0].events.removeListener("test",w),g.unshift(new h(l)),g[0].events.on("piece",w),g[0].events.on("positions",_),g[0].events.on("test",x),g[0].init())):g[0].accept()},k=e=>{v+=e*e},P=()=>{d&&(window.cancelAnimationFrame(d),d=null),p.beginPath(),p.rect(0,u.height/2-30,u.width-l.sidebar,60),p.fillStyle="rgba(255,255,255,0.5)",p.fill(),p.beginPath(),p.font="48px sans-serif",p.textAlign="center",p.textBaseline="middle",p.fillStyle="#f00",p.fillText("Game over",(u.width-l.sidebar)/2,u.height/2)},T=()=>{m&&(clearTimeout(m),m=null),g[0].update(),m=setTimeout(T,f)},L=()=>{d&&(window.cancelAnimationFrame(d),d=null),m&&(clearTimeout(m),m=null),f=500,v=0,y&&(y.events.removeListener("score",k),y.events.removeListener("end",P)),y=new a(l),y.events.on("score",k),y.events.on("end",P),g[0]&&(g[0].events.removeListener("piece",w),g[0].events.removeListener("positions",_),g[0].events.removeListener("test",w),g=[]),g.unshift(new h(l)),g[0].events.on("piece",w),g[0].events.on("positions",_),g[0].events.on("test",x),g[0].init(),d=window.requestAnimationFrame(b),T()};L(),function({move:e,newGame:t,rotate:i}){s.a.bind("up",()=>{i()}),s.a.bind("right",()=>{e("RIGHT")}),s.a.bind("down",()=>{e("DOWN")}),s.a.bind("left",()=>{e("LEFT")}),s.a.bind("enter",()=>{t()}),s.a.bind("space",()=>{t()})}({move:e=>{m&&(clearTimeout(m),m=null),m=setTimeout(T,f),g[0].move(e)},newGame:L,rotate:()=>{m&&(clearTimeout(m),m=null),m=setTimeout(T,f),g[0].rotate()}})}]);
//# sourceMappingURL=tetris.js.map